// Переменные для хранения слайдов

const slides_1 = [
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_1.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Кино',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_1.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Кино',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_1.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Кино',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_1.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Кино',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_1.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Кино',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_2.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Кино',
            },
            {
                name: 'Награды',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_3.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Пожары',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_4.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Экономика',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_1.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Кино',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_2.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Кино',
            },
            {
                name: 'Награды',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_3.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Пожары',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_4.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Экономика',
            },
        ],
    },
];

const slides_2 = [
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_2.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Кино',
            },
            {
                name: 'Награды',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_2.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Кино',
            },
            {
                name: 'Награды',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_2.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Кино',
            },
            {
                name: 'Награды',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_2.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Кино',
            },
            {
                name: 'Награды',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_2.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Кино',
            },
            {
                name: 'Награды',
            },
        ],
    },
];

const slides_3 = [
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_3.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Пожары',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_3.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Пожары',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_3.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Пожары',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_3.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Пожары',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_3.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Пожары',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_3.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Пожары',
            },
        ],
    },
];

const slides_4 = [
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_4.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Экономика',
            },
        ],
    },
    {
        title: 'Памятный знак для будущего «Сургутского кремля» создадут горожане',
        image: 'image_4.jpg',
        date: '10 июня 2023',
        tags: [
            {
                name: 'Экономика',
            },
        ],
    },
];

// Отрисовывать карточки в зависимости от id таба
function filterAndCreateSlides(value) {
    const slider = document.querySelector('.news-main__card-list');

    // Функция для создания слайда и если есть теги в нем, создания тегов
    function crateNewSlide(item) {
        function getTags(item) {
            if (item.tags && item.tags.length !== 0) {
                return item.tags.map(
                    (tag) => `
                        <span class="button button_blue button_radius news-card__tag button_size_xs button_without-event" title="">
                            <span class="button_span">${tag.name}</span>
                        </span>
                        `,
                );
            }
        }

        return `
            <a class="news-main-card" href="/" role='link'>
                <div class="news-main-card__container">
                    <div class="news-main-card__image-block"> 
                        <img class="news-main-card__image" src="../resources/${
                            item.image
                        }" alt="Изображения">
                        <div class="news-main-card__tags">
                            ${getTags(item)}
                        </div>
                    </div>
                    <div class="news-main-card__content"> 
                        <span class="news-main-card__date">${item.date}</span>
                        <span class="news-main-card__title">${item.title}</span>
                    </div>
                </div>
            </a>
        `;
    }

    $('#news-main__card-list').slick('destroy');
    slider.innerHTML = '';

    let slidesData;

    // Выбор карточек в зависимости от таба

    if (value.id === 'tab-1') {
        slidesData = slides_1;
    } else if (value.id === 'tab-2') {
        slidesData = slides_2;
    } else if (value.id === 'tab-3') {
        slidesData = slides_3;
    } else if (value.id === 'tab-4') {
        slidesData = slides_4;
    }

    slidesData.forEach((el) => {
        slider.insertAdjacentHTML('beforeend', crateNewSlide(el));
    });

    // Собираем слайдер, если разрешение меньше 992
    if (window.innerWidth < 992) {
        $('#news-main__card-list').slick({
            infinite: true,
            slidesToShow: 3,
            slidesToScroll: 1,
            arrows: false,
            variableWidth: true,
            responsive: [
                { breakpoint: 768, settings: { slidesToShow: 2 } },
                { breakpoint: 500, settings: { slidesToShow: 1 } },
            ],
        });
    }
}

// Подчеркивать таб при клике и получать текущий id таба
document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('.tab-button');

    if (!tabs || tabs.length === 0) {
        console.error('Вкладок не найдено.');
        return;
    }

    tabs.forEach((tab) => {
        tab.addEventListener('click', (e) => {
            e.preventDefault();

            tabs.forEach((t) => t.classList.remove('tab-button_active'));
            e.target.classList.add('tab-button_active');
            window.sessionStorage.setItem('tabValue', e.target.textContent);
            filterAndCreateSlides(e.target);
        });
    });

    // Если в сессионном хранилище есть значение для таба, то подчеркиваем нужные таб
    // и рисуем карточки по фильтру, если нет - то подчеркиваем 1 таб и карточки для него
    const savedTabValue = window.sessionStorage.getItem('tabValue');

    if (savedTabValue) {
        tabs.forEach((tab) => {
            if (tab.textContent === savedTabValue) {
                tab.classList.add('tab-button_active');
                filterAndCreateSlides(tab);
            }
        });
    } else {
        tabs[0].classList.add('tab-button_active');
        filterAndCreateSlides(tabs[0]);
    }
});
